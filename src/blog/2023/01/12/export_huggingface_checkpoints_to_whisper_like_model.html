
<!DOCTYPE html>

<html lang="english">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta property="og:title" content="Export Huggingface checkpoints into a whisper-like model" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://superkogito.github.io/blog/2023/01/12/export_huggingface_checkpoints_to_whisper_like_model.html" />
<meta property="og:site_name" content="üß† SuperKogito" />
<meta property="og:description" content="Whipser based speech recognition model from Huggingface checkpoints" />
<meta property="og:image" content="http://superkogito.github.io/_static/meta_images/export_huggingface_checkpoints_to_whisper_like_model.png" />
<meta property="og:image:alt" content="export_huggingface_checkpoints_to_whisper_like_model" />
<meta property="og:keywords" content="whisper, speech recognition, authentication, Huggingface checkpoints, python, ayoub malek, blog post" />
<meta name="description" content="With the recent release of whisper by OpenAI, a immense number of finetuning opportunities in the field of Automatic Speech Recognition (ASR). Luckily, Huggingface provides a simple and clear tutorial on how to finetune the whisper model. What is finetuning?: There are different approaches to imp..." />
<meta property="og:ignore_canonical" content="true" />

    <title>Export Huggingface checkpoints into a whisper-like model &#8212; üß† SuperKogito  documentation</title>
    
  <link href="../../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/twemoji.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/tree_graph.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/social_media_sharing.css" />
    
  <link rel="preload" as="script" href="../../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js"></script>
    <script src="../../../../_static/twemoji.js"></script>
    <link rel="canonical" href="http://superkogito.github.io/blog/2023/01/12/export_huggingface_checkpoints_to_whisper_like_model.html" />
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../../../about.html" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="english">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-133660046-1', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>
 
<link
  rel="alternate"
  type="application/atom+xml"
  href="../../../../blog/atom.xml"
  title="SuperKogito"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../../../../index.html">
<p class="title">üß† SuperKogito</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../index.html">
  Home
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../projects.html">
  Projects
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../blog.html">
  Blog
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../../../about.html">
  About Me
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this site..." aria-label="Search this site..." autocomplete="off" >
</form>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/superkogito/" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">  
<h2>
   <i class="fa-brands fa-calendar"></i>
  12 January 2023 
</h2>

<ul>
   
<li id="author">
  <span><i class="fa-fw fa-brands fa-user"></i></span
  >
   
  <a href="../../../author/ayoub-malek.html">Ayoub Malek</a>  
</li>
 
<li id="location">
  <span><i class="fa-fw fa-brands fa-location-arrow"></i></span
  >
   
  <a href="../../../location/munich.html">Munich</a>  
</li>
 
<li id="language">
  <span><i class="fa-fw fa-brands fa-language"></i></span
  >
   
  <a href="../../../language/english.html">English</a>  
</li>
 
<li id="category">
  <span><i class="fa-fw fa-brands fa-folder-open"></i></span
  >
   
  <a href="../../../category/python.html">Python</a>  
</li>
 
<li id="tags">
  <span><i class="fa-fw fa-brands fa-tags"></i> </span
  >
   
  <a href="../../../tag/python.html">Python</a>   
  <a href="../../../tag/whisper.html">Whisper</a>   
  <a href="../../../tag/speech-recognition.html">Speech recognition</a>   
  <a href="../../../tag/huggingface.html">Huggingface</a>  
</li>
 
</ul>

<h3>
  <a href="../../../../blog.html">‚úçÔ∏è Recent Posts</a>
</h3>
<ul>
   
  <li>
    <a href="../../../2022/12/27/whisper_aiohttp_server_with_token.html"
      >Whisper based speech recognition server</a>
      <p>27 December 2022</p>
  </li>
  
  <li>
    <a href="../../../2021/12/31/aiohttp_server_with_token.html"
      >Token authenticated aiohttp server</a>
      <p>31 December 2021</p>
  </li>
  
  <li>
    <a href="../../../2021/12/31/aiohttp_server.html"
      >Basic aiohttp server</a>
      <p>31 December 2021</p>
  </li>
  
  <li>
    <a href="../../../2020/10/25/chmod_modes.html"
      >Chmod modes: from symbolic to octal and back</a>
      <p>25 October 2020</p>
  </li>
  
  <li>
    <a href="../../../2020/10/03/divide_image_using_gdiplus.html"
      >Divide an image into blocks using GDI+ in C++</a>
      <p>03 October 2020</p>
  </li>
  
</ul>

<h3>
  <a href="../../../archive.html">üóìÔ∏è Archives</a>
</h3>
<ul>
   
  <li>
    <a href="../../../2023.html">2023 (1)</a>
  </li>
    
  <li>
    <a href="../../../2022.html">2022 (1)</a>
  </li>
    
  <li>
    <a href="../../../2021.html">2021 (2)</a>
  </li>
    
  <li>
    <a href="../../../2020.html">2020 (13)</a>
  </li>
    
  <li>
    <a href="../../../2019.html">2019 (7)</a>
  </li>
   
</ul>

            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-is-finetuning">
   What is finetuning?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-convert-the-huggingface-checkpoints-to-a-whisper-like-model">
   Why convert the Huggingface checkpoints to a whisper-like model?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-convert-the-huggingface-checkpoints-to-a-whisper-like-model">
   How to convert the Huggingface checkpoints to a whisper-like model?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing">
   Testing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#share-this-blog">
   Share this blog
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              


<!--  Bootstrap HTML  -->
<div id="lawmsg" class="alert alert-info alert-dismissible h5 fade show fixed-bottom" role="alert">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    We use cookies on this website to distinguish you from other users.
    We use this data to improve our content experience and for targeted advertising.
    By continuing to use this website you consent to our use of cookies.
    For more information, please see our
    <a href="https://superkogito.github.io/policy/cookies_policy.html" target="_blank">Cookie Policy</a>.
</div>



              <div>
                 <section id="export-huggingface-checkpoints-into-a-whisper-like-model">
<h1>Export Huggingface checkpoints into a whisper-like model<a class="headerlink" href="#export-huggingface-checkpoints-into-a-whisper-like-model" title="Permalink to this headline">¬∂</a></h1>
<hr class="docutils" />
<p>With the recent release of <a class="reference external" href="https://github.com/openai/whisper">whisper</a> by <a class="reference external" href="https://openai.com/">OpenAI</a>, a immense number of finetuning opportunities in the field of Automatic Speech Recognition (ASR).
Luckily, Huggingface provides a simple and clear tutorial on how to finetune the whisper model.</p>
<section id="what-is-finetuning">
<h2>What is finetuning?<a class="headerlink" href="#what-is-finetuning" title="Permalink to this headline">¬∂</a></h2>
<p>There are different approaches to implement this. The choice here is arbitrary, I chose whisper since it is accurate and simple to integrate.
One way to implement this is to use the whisper transcribe function. This can be done as follows:</p>
</section>
<section id="why-convert-the-huggingface-checkpoints-to-a-whisper-like-model">
<h2>Why convert the Huggingface checkpoints to a whisper-like model?<a class="headerlink" href="#why-convert-the-huggingface-checkpoints-to-a-whisper-like-model" title="Permalink to this headline">¬∂</a></h2>
<p>To export the checkpoints to a whisper-like format, we must rename various model paramters so they can adhere to the whisper format.
This is a simple dictionary remaping.</p>
</section>
<section id="how-to-convert-the-huggingface-checkpoints-to-a-whisper-like-model">
<h2>How to convert the Huggingface checkpoints to a whisper-like model?<a class="headerlink" href="#how-to-convert-the-huggingface-checkpoints-to-a-whisper-like-model" title="Permalink to this headline">¬∂</a></h2>
<p>The previously listed steps, should look together in Python as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>  <span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 2</span><span class="sd">  The following code is based on:</span>
<span class="linenos"> 3</span><span class="sd">  - https://github.com/bayartsogt-ya/whisper-multiple-hf-datasets</span>
<span class="linenos"> 4</span><span class="sd">  &quot;&quot;&quot;</span>
<span class="linenos"> 5</span>  <span class="kn">import</span> <span class="nn">re</span>
<span class="linenos"> 6</span>  <span class="kn">import</span> <span class="nn">torch</span>
<span class="linenos"> 7</span>  <span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">WhisperForConditionalGeneration</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>  <span class="n">whisper_mappings</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">11</span>      <span class="s2">&quot;layers&quot;</span><span class="p">:</span> <span class="s2">&quot;blocks&quot;</span><span class="p">,</span>
<span class="linenos">12</span>      <span class="s2">&quot;fc1&quot;</span><span class="p">:</span> <span class="s2">&quot;mlp.0&quot;</span><span class="p">,</span>
<span class="linenos">13</span>      <span class="s2">&quot;fc2&quot;</span><span class="p">:</span> <span class="s2">&quot;mlp.2&quot;</span><span class="p">,</span>
<span class="linenos">14</span>      <span class="s2">&quot;final_layer_norm&quot;</span><span class="p">:</span> <span class="s2">&quot;mlp_ln&quot;</span><span class="p">,</span>
<span class="linenos">15</span>      <span class="s2">&quot;.self_attn.q_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.attn.query&quot;</span><span class="p">,</span>
<span class="linenos">16</span>      <span class="s2">&quot;.self_attn.k_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.attn.key&quot;</span><span class="p">,</span>
<span class="linenos">17</span>      <span class="s2">&quot;.self_attn.v_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.attn.value&quot;</span><span class="p">,</span>
<span class="linenos">18</span>      <span class="s2">&quot;.self_attn_layer_norm&quot;</span><span class="p">:</span> <span class="s2">&quot;.attn_ln&quot;</span><span class="p">,</span>
<span class="linenos">19</span>      <span class="s2">&quot;.self_attn.out_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.attn.out&quot;</span><span class="p">,</span>
<span class="linenos">20</span>      <span class="s2">&quot;.encoder_attn.q_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.cross_attn.query&quot;</span><span class="p">,</span>
<span class="linenos">21</span>      <span class="s2">&quot;.encoder_attn.k_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.cross_attn.key&quot;</span><span class="p">,</span>
<span class="linenos">22</span>      <span class="s2">&quot;.encoder_attn.v_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.cross_attn.value&quot;</span><span class="p">,</span>
<span class="linenos">23</span>      <span class="s2">&quot;.encoder_attn_layer_norm&quot;</span><span class="p">:</span> <span class="s2">&quot;.cross_attn_ln&quot;</span><span class="p">,</span>
<span class="linenos">24</span>      <span class="s2">&quot;.encoder_attn.out_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.cross_attn.out&quot;</span><span class="p">,</span>
<span class="linenos">25</span>      <span class="s2">&quot;decoder.layer_norm.&quot;</span><span class="p">:</span> <span class="s2">&quot;decoder.ln.&quot;</span><span class="p">,</span>
<span class="linenos">26</span>      <span class="s2">&quot;encoder.layer_norm.&quot;</span><span class="p">:</span> <span class="s2">&quot;encoder.ln_post.&quot;</span><span class="p">,</span>
<span class="linenos">27</span>      <span class="s2">&quot;embed_tokens&quot;</span><span class="p">:</span> <span class="s2">&quot;token_embedding&quot;</span><span class="p">,</span>
<span class="linenos">28</span>      <span class="s2">&quot;encoder.embed_positions.weight&quot;</span><span class="p">:</span> <span class="s2">&quot;encoder.positional_embedding&quot;</span><span class="p">,</span>
<span class="linenos">29</span>      <span class="s2">&quot;decoder.embed_positions.weight&quot;</span><span class="p">:</span> <span class="s2">&quot;decoder.positional_embedding&quot;</span><span class="p">,</span>
<span class="linenos">30</span>      <span class="s2">&quot;layer_norm&quot;</span><span class="p">:</span> <span class="s2">&quot;ln_post&quot;</span><span class="p">,</span>
<span class="linenos">31</span>  <span class="p">}</span>
<span class="linenos">32</span>
<span class="linenos">33</span>  <span class="k">def</span> <span class="nf">format_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="linenos">34</span>      <span class="c1"># format replacements</span>
<span class="linenos">35</span>      <span class="n">rep_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">whisper_mappings</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">36</span>      <span class="n">rep_escaped</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">,</span> <span class="n">rep_sorted</span><span class="p">)</span>
<span class="linenos">37</span>
<span class="linenos">38</span>      <span class="c1"># Create a big OR regex that matches any of the substrings to replace</span>
<span class="linenos">39</span>      <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rep_escaped</span><span class="p">))</span>
<span class="linenos">40</span>
<span class="linenos">41</span>      <span class="c1"># For each match, look up the new string in the replacements, being the key the normalized old string</span>
<span class="linenos">42</span>      <span class="n">new_key</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">whisper_mappings</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span> <span class="n">key</span><span class="p">)</span>
<span class="linenos">43</span>
<span class="linenos">44</span>      <span class="c1"># debug</span>
<span class="linenos">45</span>      <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<span class="linenos">46</span>          <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">new_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">47</span>      <span class="k">return</span> <span class="n">new_key</span>
<span class="linenos">48</span>
<span class="linenos">49</span>  <span class="k">def</span> <span class="nf">convert_hf_checkpoints_to_whisper</span><span class="p">(</span><span class="n">checkpoints_path</span><span class="p">,</span> <span class="n">generated_whisper_model_path</span><span class="p">,</span> <span class="n">verbose</span><span class="p">):</span>
<span class="linenos">50</span>      <span class="k">try</span><span class="p">:</span>
<span class="linenos">51</span>          <span class="c1"># load checkpoints</span>
<span class="linenos">52</span>          <span class="n">transformer_model</span> <span class="o">=</span> <span class="n">WhisperForConditionalGeneration</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">checkpoints_path</span><span class="p">)</span>
<span class="linenos">53</span>          <span class="n">config</span> <span class="o">=</span> <span class="n">transformer_model</span><span class="o">.</span><span class="n">config</span>
<span class="linenos">54</span>
<span class="linenos">55</span>          <span class="c1"># build dims</span>
<span class="linenos">56</span>          <span class="n">dims</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">57</span>              <span class="s2">&quot;n_mels&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">num_mel_bins</span><span class="p">,</span>
<span class="linenos">58</span>              <span class="s2">&quot;n_vocab&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">vocab_size</span><span class="p">,</span>
<span class="linenos">59</span>              <span class="s2">&quot;n_audio_ctx&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">max_source_positions</span><span class="p">,</span>
<span class="linenos">60</span>              <span class="s2">&quot;n_audio_state&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span>
<span class="linenos">61</span>              <span class="s2">&quot;n_audio_head&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">encoder_attention_heads</span><span class="p">,</span>
<span class="linenos">62</span>              <span class="s2">&quot;n_audio_layer&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">encoder_layers</span><span class="p">,</span>
<span class="linenos">63</span>              <span class="s2">&quot;n_text_ctx&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">max_target_positions</span><span class="p">,</span>
<span class="linenos">64</span>              <span class="s2">&quot;n_text_state&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span>
<span class="linenos">65</span>              <span class="s2">&quot;n_text_head&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">decoder_attention_heads</span><span class="p">,</span>
<span class="linenos">66</span>              <span class="s2">&quot;n_text_layer&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">decoder_layers</span><span class="p">,</span>
<span class="linenos">67</span>          <span class="p">}</span>
<span class="linenos">68</span>
<span class="linenos">69</span>          <span class="c1"># convert</span>
<span class="linenos">70</span>          <span class="n">hf_state_dict</span> <span class="o">=</span> <span class="n">transformer_model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>
<span class="linenos">71</span>          <span class="n">whisper_state_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="n">format_key</span><span class="p">(</span><span class="n">hf_key</span><span class="p">,</span> <span class="n">verbose</span><span class="p">):</span> <span class="n">hf_value</span> <span class="k">for</span> <span class="n">hf_key</span><span class="p">,</span> <span class="n">hf_value</span> <span class="ow">in</span> <span class="n">hf_state_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>
<span class="linenos">72</span>
<span class="linenos">73</span>          <span class="c1"># save model</span>
<span class="linenos">74</span>          <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">({</span><span class="s2">&quot;dims&quot;</span><span class="p">:</span> <span class="n">dims</span><span class="p">,</span> <span class="s2">&quot;model_state_dict&quot;</span><span class="p">:</span> <span class="n">whisper_state_dict</span><span class="p">},</span> <span class="n">generated_whisper_model_path</span><span class="p">)</span>
<span class="linenos">75</span>          <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&gt; whisper-like model is exported under &quot;</span><span class="p">,</span> <span class="n">generated_whisper_model_path</span><span class="p">)</span>
<span class="linenos">76</span>      <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos">77</span>          <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<span class="linenos">78</span>          <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ConversionError: could not convert checkpoints.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can wrap a cli tool/ script around the previous function, to have something more fancy that we can from the terminal.
The code then should look as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span>  <span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">  2</span><span class="sd">  The following code is based on:</span>
<span class="linenos">  3</span><span class="sd">  - https://github.com/bayartsogt-ya/whisper-multiple-hf-datasets</span>
<span class="linenos">  4</span><span class="sd">  &quot;&quot;&quot;</span>
<span class="linenos">  5</span>  <span class="kn">import</span> <span class="nn">re</span>
<span class="linenos">  6</span>  <span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos">  7</span>  <span class="kn">import</span> <span class="nn">torch</span>
<span class="linenos">  8</span>  <span class="kn">import</span> <span class="nn">argparse</span>
<span class="linenos">  9</span>  <span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">WhisperForConditionalGeneration</span>
<span class="linenos"> 10</span>
<span class="linenos"> 11</span>
<span class="linenos"> 12</span>  <span class="n">whisper_mappings</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 13</span>      <span class="s2">&quot;layers&quot;</span><span class="p">:</span> <span class="s2">&quot;blocks&quot;</span><span class="p">,</span>
<span class="linenos"> 14</span>      <span class="s2">&quot;fc1&quot;</span><span class="p">:</span> <span class="s2">&quot;mlp.0&quot;</span><span class="p">,</span>
<span class="linenos"> 15</span>      <span class="s2">&quot;fc2&quot;</span><span class="p">:</span> <span class="s2">&quot;mlp.2&quot;</span><span class="p">,</span>
<span class="linenos"> 16</span>      <span class="s2">&quot;final_layer_norm&quot;</span><span class="p">:</span> <span class="s2">&quot;mlp_ln&quot;</span><span class="p">,</span>
<span class="linenos"> 17</span>      <span class="s2">&quot;.self_attn.q_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.attn.query&quot;</span><span class="p">,</span>
<span class="linenos"> 18</span>      <span class="s2">&quot;.self_attn.k_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.attn.key&quot;</span><span class="p">,</span>
<span class="linenos"> 19</span>      <span class="s2">&quot;.self_attn.v_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.attn.value&quot;</span><span class="p">,</span>
<span class="linenos"> 20</span>      <span class="s2">&quot;.self_attn_layer_norm&quot;</span><span class="p">:</span> <span class="s2">&quot;.attn_ln&quot;</span><span class="p">,</span>
<span class="linenos"> 21</span>      <span class="s2">&quot;.self_attn.out_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.attn.out&quot;</span><span class="p">,</span>
<span class="linenos"> 22</span>      <span class="s2">&quot;.encoder_attn.q_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.cross_attn.query&quot;</span><span class="p">,</span>
<span class="linenos"> 23</span>      <span class="s2">&quot;.encoder_attn.k_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.cross_attn.key&quot;</span><span class="p">,</span>
<span class="linenos"> 24</span>      <span class="s2">&quot;.encoder_attn.v_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.cross_attn.value&quot;</span><span class="p">,</span>
<span class="linenos"> 25</span>      <span class="s2">&quot;.encoder_attn_layer_norm&quot;</span><span class="p">:</span> <span class="s2">&quot;.cross_attn_ln&quot;</span><span class="p">,</span>
<span class="linenos"> 26</span>      <span class="s2">&quot;.encoder_attn.out_proj&quot;</span><span class="p">:</span> <span class="s2">&quot;.cross_attn.out&quot;</span><span class="p">,</span>
<span class="linenos"> 27</span>      <span class="s2">&quot;decoder.layer_norm.&quot;</span><span class="p">:</span> <span class="s2">&quot;decoder.ln.&quot;</span><span class="p">,</span>
<span class="linenos"> 28</span>      <span class="s2">&quot;encoder.layer_norm.&quot;</span><span class="p">:</span> <span class="s2">&quot;encoder.ln_post.&quot;</span><span class="p">,</span>
<span class="linenos"> 29</span>      <span class="s2">&quot;embed_tokens&quot;</span><span class="p">:</span> <span class="s2">&quot;token_embedding&quot;</span><span class="p">,</span>
<span class="linenos"> 30</span>      <span class="s2">&quot;encoder.embed_positions.weight&quot;</span><span class="p">:</span> <span class="s2">&quot;encoder.positional_embedding&quot;</span><span class="p">,</span>
<span class="linenos"> 31</span>      <span class="s2">&quot;decoder.embed_positions.weight&quot;</span><span class="p">:</span> <span class="s2">&quot;decoder.positional_embedding&quot;</span><span class="p">,</span>
<span class="linenos"> 32</span>      <span class="s2">&quot;layer_norm&quot;</span><span class="p">:</span> <span class="s2">&quot;ln_post&quot;</span><span class="p">,</span>
<span class="linenos"> 33</span>  <span class="p">}</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span>  <span class="k">def</span> <span class="nf">format_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="linenos"> 36</span>      <span class="c1"># format replacements</span>
<span class="linenos"> 37</span>      <span class="n">rep_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">whisper_mappings</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 38</span>      <span class="n">rep_escaped</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">,</span> <span class="n">rep_sorted</span><span class="p">)</span>
<span class="linenos"> 39</span>
<span class="linenos"> 40</span>      <span class="c1"># Create a big OR regex that matches any of the substrings to replace</span>
<span class="linenos"> 41</span>      <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rep_escaped</span><span class="p">))</span>
<span class="linenos"> 42</span>
<span class="linenos"> 43</span>      <span class="c1"># For each match, look up the new string in the replacements, being the key the normalized old string</span>
<span class="linenos"> 44</span>      <span class="n">new_key</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">whisper_mappings</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span> <span class="n">key</span><span class="p">)</span>
<span class="linenos"> 45</span>
<span class="linenos"> 46</span>      <span class="c1"># debug</span>
<span class="linenos"> 47</span>      <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<span class="linenos"> 48</span>          <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">new_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 49</span>      <span class="k">return</span> <span class="n">new_key</span>
<span class="linenos"> 50</span>
<span class="linenos"> 51</span>  <span class="k">def</span> <span class="nf">convert_hf_checkpoints_to_whisper</span><span class="p">(</span><span class="n">checkpoints_path</span><span class="p">,</span> <span class="n">generated_whisper_model_path</span><span class="p">,</span> <span class="n">verbose</span><span class="p">):</span>
<span class="linenos"> 52</span>      <span class="k">try</span><span class="p">:</span>
<span class="linenos"> 53</span>          <span class="c1"># load checkpoints</span>
<span class="linenos"> 54</span>          <span class="n">transformer_model</span> <span class="o">=</span> <span class="n">WhisperForConditionalGeneration</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">checkpoints_path</span><span class="p">)</span>
<span class="linenos"> 55</span>          <span class="n">config</span> <span class="o">=</span> <span class="n">transformer_model</span><span class="o">.</span><span class="n">config</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span>          <span class="c1"># build dims</span>
<span class="linenos"> 58</span>          <span class="n">dims</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 59</span>              <span class="s2">&quot;n_mels&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">num_mel_bins</span><span class="p">,</span>
<span class="linenos"> 60</span>              <span class="s2">&quot;n_vocab&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">vocab_size</span><span class="p">,</span>
<span class="linenos"> 61</span>              <span class="s2">&quot;n_audio_ctx&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">max_source_positions</span><span class="p">,</span>
<span class="linenos"> 62</span>              <span class="s2">&quot;n_audio_state&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span>
<span class="linenos"> 63</span>              <span class="s2">&quot;n_audio_head&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">encoder_attention_heads</span><span class="p">,</span>
<span class="linenos"> 64</span>              <span class="s2">&quot;n_audio_layer&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">encoder_layers</span><span class="p">,</span>
<span class="linenos"> 65</span>              <span class="s2">&quot;n_text_ctx&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">max_target_positions</span><span class="p">,</span>
<span class="linenos"> 66</span>              <span class="s2">&quot;n_text_state&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">d_model</span><span class="p">,</span>
<span class="linenos"> 67</span>              <span class="s2">&quot;n_text_head&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">decoder_attention_heads</span><span class="p">,</span>
<span class="linenos"> 68</span>              <span class="s2">&quot;n_text_layer&quot;</span><span class="p">:</span> <span class="n">config</span><span class="o">.</span><span class="n">decoder_layers</span><span class="p">,</span>
<span class="linenos"> 69</span>          <span class="p">}</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span>          <span class="c1"># convert</span>
<span class="linenos"> 72</span>          <span class="n">hf_state_dict</span> <span class="o">=</span> <span class="n">transformer_model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>
<span class="linenos"> 73</span>          <span class="n">whisper_state_dict</span> <span class="o">=</span> <span class="p">{</span> <span class="n">format_key</span><span class="p">(</span><span class="n">hf_key</span><span class="p">,</span> <span class="n">verbose</span><span class="p">):</span> <span class="n">hf_value</span> <span class="k">for</span> <span class="n">hf_key</span><span class="p">,</span> <span class="n">hf_value</span> <span class="ow">in</span> <span class="n">hf_state_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>
<span class="linenos"> 74</span>
<span class="linenos"> 75</span>          <span class="c1"># save model</span>
<span class="linenos"> 76</span>          <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">({</span><span class="s2">&quot;dims&quot;</span><span class="p">:</span> <span class="n">dims</span><span class="p">,</span> <span class="s2">&quot;model_state_dict&quot;</span><span class="p">:</span> <span class="n">whisper_state_dict</span><span class="p">},</span> <span class="n">generated_whisper_model_path</span><span class="p">)</span>
<span class="linenos"> 77</span>          <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&gt; whisper-like model is exported under &quot;</span><span class="p">,</span> <span class="n">generated_whisper_model_path</span><span class="p">)</span>
<span class="linenos"> 78</span>      <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos"> 79</span>          <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
<span class="linenos"> 80</span>          <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ConversionError: could not convert checkpoints.&quot;</span><span class="p">)</span>
<span class="linenos"> 81</span>
<span class="linenos"> 82</span>  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos"> 83</span>      <span class="c1"># init parser</span>
<span class="linenos"> 84</span>      <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="linenos"> 85</span>      <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<span class="linenos"> 86</span>          <span class="s2">&quot;--hf_checkpoints_path&quot;</span><span class="p">,</span>
<span class="linenos"> 87</span>          <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
<span class="linenos"> 88</span>          <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 89</span>          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;csv file with data to use for testing.&quot;</span><span class="p">,</span>
<span class="linenos"> 90</span>      <span class="p">)</span>
<span class="linenos"> 91</span>      <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<span class="linenos"> 92</span>          <span class="s2">&quot;--exported_model_path&quot;</span><span class="p">,</span>
<span class="linenos"> 93</span>          <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
<span class="linenos"> 94</span>          <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="linenos"> 95</span>          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;path to whisper model.&quot;</span><span class="p">,</span>
<span class="linenos"> 96</span>      <span class="p">)</span>
<span class="linenos"> 97</span>      <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<span class="linenos"> 98</span>          <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span>
<span class="linenos"> 99</span>          <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="linenos">100</span>          <span class="n">help</span><span class="o">=</span><span class="s2">&quot;logs verbosity (if True).&quot;</span><span class="p">,</span>
<span class="linenos">101</span>          <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span>
<span class="linenos">102</span>      <span class="p">)</span>
<span class="linenos">103</span>
<span class="linenos">104</span>      <span class="c1"># check args</span>
<span class="linenos">105</span>      <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="linenos">106</span>      <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">hf_checkpoints_path</span><span class="p">:</span>
<span class="linenos">107</span>          <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You need to specify the checkpoints path via &quot;the --hf_checkpoints_path flag.&quot;&#39;</span><span class="p">)</span>
<span class="linenos">108</span>          <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">109</span>
<span class="linenos">110</span>      <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">exported_model_path</span><span class="p">:</span>
<span class="linenos">111</span>          <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You need to specify a path for the generated model via &quot;the --exported_model_path flag.&quot;&#39;</span><span class="p">)</span>
<span class="linenos">112</span>          <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">113</span>
<span class="linenos">114</span>      <span class="c1"># export model</span>
<span class="linenos">115</span>      <span class="n">convert_hf_checkpoints_to_whisper</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">hf_checkpoints_path</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">exported_model_path</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
<span class="linenos">116</span>
<span class="linenos">117</span>
<span class="linenos">118</span>  <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">119</span>      <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¬∂</a></h2>
<p>To test this script, simply convert your finetuned/ trained checkpoints to a model via <code class="code docutils literal notranslate"><span class="pre">python</span> <span class="pre">export.py</span> <span class="pre">--hf_checkpoints_path/checkpoint-4000</span> <span class="pre">--exported_model_path</span> <span class="pre">finetuned_whisper_model.pt</span> <span class="pre">--verbose</span></code>.
Afterwards, load the model and then then transcribe with it, this can be done using:</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¬∂</a></h2>
<p>This blog introduced a small script that helps convert the whisper model finetuning resulting checkpoints into a whisper-like model.
This model is smaller in size than the checkpoints and can be further quantized to compress it even more and achieve faster inference.</p>
</section>
<section id="share-this-blog">
<h2>Share this blog<a class="headerlink" href="#share-this-blog" title="Permalink to this headline">¬∂</a></h2>
<div id="share">
  <a class="facebook" href="https://www.facebook.com/share.php?u=https://superkogito.github.io/blog/2022/12/27/whisper_aiohttp_server_with_token.html&title=whisper%20aiohttp%20server%20with%20token"                target="blank"><i class="fa-brands fa-facebook"></i></a>
  <a class="twitter"  href="https://twitter.com/intent/tweet?url=https://superkogito.github.io/blog/2022/12/27/whisper_aiohttp_server_with_token.html&text=whisper%20aiohttp%20server%20with%20token"                 target="blank"><i class="fa-brands fa-twitter"></i></a>
  <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://superkogito.github.io/blog/2022/12/27/whisper_aiohttp_server_with_token.html&title=whisper%20aiohttp%20server%20with%20token" target="blank"><i class="fa-brands fa-linkedin"></i></a>
  <a class="reddit"   href="http://www.reddit.com/submit?url=https://superkogito.github.io/blog/2022/12/27/whisper_aiohttp_server_with_token.html&title=whisper%20aiohttp%20server%20with%20token"                    target="blank"><i class="fa-brands fa-reddit"></i></a>
</div><div class="note update admonition">
<p class="admonition-title">Updated on 12 January 2023</p>
<p>üë®‚Äçüíª edited and review were on 27.12.2022</p>
</div>
</section>
</section>

<div class="section">
    

<div class="section">
  <span style="float: left">
     
    <a href="../../../2022/12/27/whisper_aiohttp_server_with_token.html">
      <i class="fa-brands fa-arrow-circle-left"></i> Whisper based speech recognition server
    </a>
    
  </span>
  <span>&nbsp;</span>
  <span style="float: right">
    
  </span>
</div>
  
</div>

              </div>
              
<!-- Add a comment box underneath the page's content -->
<script src="https://giscus.app/client.js"
        data-repo="superKogito/SuperKogito.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxNTk5NjI3Mjg="
        data-category="Announcements"
        data-category-id="DIC_kwDOCYjWaM4CObax"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
<script src="../_static/cookiealert.js"></script>

              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
      <!-- Site footer -->
      <div class="container">
        <div class="row">
          <div class="col-xs-6 col-md-6">
            <ul class="footer-links">
              <li>
                    &copy; Copyright 2019-2023, Ayoub Malek.<br/>
                  This blog is created using <a href="http://sphinx-doc.org/">Sphinx</a> and the tools from <a href="https://executablebooks.org/en/latest/">The Executable Book Project</a>.<br/>
              </li>
            </ul>
          </div>

          <div class="col-xs-6 col-md-2">
            <ul class="footer-links">
              <li><a href="https://superkogito.github.io/policy/privacy_policy.html">Privacy Policy</a></li>
              <li><a href="https://superkogito.github.io/policy/cookies_policy.html">Cookies policy</a></li>
            </ul>
          </div>

          <div class="col-xs-6 col-md-2">
            <ul class="footer-links">
              <li><a href="https://superkogito.github.io/policy/terms_and_conditions.html">Terms and conditions</a></li>
              <li><a href="https://superkogito.github.io/policy/disclaimer.html">Disclaimer</a></li>
            </ul>
          </div>

          <div class="col-xs-6 col-md-2">
            <ul class="footer-links">
              <li><a href="https://superkogito.github.io/policy/contribute.html">Contribute</a></li>
              <li><a href="https://superkogito.github.io/sitemap.xml">Sitemap</a></li>
            </ul>
          </div>

    </div>
  </footer>
  </body>
</html>