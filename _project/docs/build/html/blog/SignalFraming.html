
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8"/><meta content="Audio signal framing/ frame blocking" name="description"/>
<meta content="framing, frame blocking, Ayoub Malek, Blogging" name="keywords"/>
<meta content="Ayoub Malek" name="author"/>
<script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-133660046-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
<title>[25-01-2020] Signal framing — Ayoub Malek's blog</title>
<link href="../_static/alabaster.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
<link href="../_static/css/custom_style.css" rel="stylesheet" type="text/css"/>
<link href="../_static/css/code_style.css" rel="stylesheet" type="text/css"/>
<link href="../_static/css/tree_graph.css" rel="stylesheet" type="text/css"/>
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js" type="text/javascript"></script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<script src="../_static/language_data.js" type="text/javascript"></script>
<script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<link href="../_static/favicon.ico" rel="shortcut icon"/>
<link href="../about.html" rel="author" title="About these documents"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="../_static/custom.css" rel="stylesheet" type="text/css"/>
<meta content="width=device-width, initial-scale=0.9, maximum-scale=0.9" name="viewport"/>
<style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>
</head><body>
<div class="document">
<div class="documentwrapper">
<div class="body" role="main">
<div class="section" id="signal-framing">
<h1>[25-01-2020] Signal framing<a class="headerlink" href="#signal-framing" title="Permalink to this headline">¶</a></h1>
<div class="sub-title-menu">
<a href="../index.html" title="Home"><i class="fa fa-home"></i>Home</a>
<a href="../blog.html" title="Posts"><i class="fa fa-bars"></i>Posts</a>
<a href="../publications.html" title="pubs"><i class="fa fa-file-text"></i>Publications</a>
<a href="../projects.html" title="projects"><i class="fa fa-code"></i>Projects</a>
<a href="../games.html" title="Games"><i class="fa fa-gamepad"></i>Games</a>
<a href="../about.html" title="About"><i class="fa fa-user-circle"></i>About</a>
<a href="#" onclick="modeSwitcher()"><i class="fa fa-adjust"></i><text id="theme-toggle">DARK MODE</text></a>
</div>

<hr class="docutils"/>
<p>When it comes to non-stationary signals, spectral features in short parts/ sequences are of great use.
Therefore, decomposing the signal into multiple ranges is the way to go about this type of features extraction.
This technique is known as frame blocking or framing. The following blog explains why do we need framing and how to do it in python.</p>
<div class="line-block">
<div class="line"><strong>* keywords:  *</strong> Framing, Frame blocking</div>
</div>
<div class="section" id="what-is-framing">
<h2>What is framing ?<a class="headerlink" href="#what-is-framing" title="Permalink to this headline">¶</a></h2>
<p>Frame blocking or framing is a fundamental signal processing technique that consists of dividing
the original signal into N blocks often called frames with an overlap M.
Overlapping the frames help avoiding information loss in between adjacent frames.</p>
<div class="line-block">
<div class="line"><br/></div>
</div>
<a class="reference internal image-reference" href="../_images/framing.png"><img alt="../_images/framing.png" class="align-center" src="../_images/framing.png" style="width: 322.15px; height: 136.0px;"/></a>
<center><a href="../figures/fig16.html">Figure 16: Framing</a> </center>
</div></div>
<div class="section" id="why-do-we-do-need-framing">
<h2>Why do we do need framing?<a class="headerlink" href="#why-do-we-do-need-framing" title="Permalink to this headline">¶</a></h2>
<p>Speech is a non-stationary signal, consequently its statistical properties are not constant over time.
Therefore, its spectral features and other characteristic properties (for example: short-time energy, MFCC etc.) should be extracted from small blocks of the signal.
This is based on the assumption that is the signal is stationary (i.e.  its  statistical properties  are  constant  within this region) in this small frame <a class="reference internal" href="#deller" id="id1">[JRJD87]</a>.
On top of it all, frame blocking is often used in real-time systems as it maximizes the efficiency of the system by distributing the fixed process overhead across many samples :cite:<a href="#id2"><span class="problematic" id="id3">``</span></a>.</p>
</div>
<div class="section" id="how-to-implement-it">
<h2>How to implement it?<a class="headerlink" href="#how-to-implement-it" title="Permalink to this headline">¶</a></h2>
<p>The first approach is pretty straight forward and can be summarized in the following steps:</p>
<ul class="simple">
<li><p>Convert step and fame length from seconds to samples.</p></li>
<li><p>Compute the expected number of frames.</p></li>
<li><p>Pad signal if needed.</p></li>
<li><p>Compute frames indices.</p></li>
<li><p>Get frames.</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Framing 1</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>


 <span class="k">def</span> <span class="nf">framing</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span> <span class="n">win_len</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">win_hop</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
     <span class="sd">"""</span>
<span class="sd">     transform a signal into a series of overlapping frames.</span>

<span class="sd">     Args:</span>
<span class="sd">         sig            (array) : a mono audio signal (Nx1) from which to compute features.</span>
<span class="sd">         fs               (int) : the sampling frequency of the signal we are working with.</span>
<span class="sd">                                  Default is 16000.</span>
<span class="sd">         win_len        (float) : window length in sec.</span>
<span class="sd">                                  Default is 0.025.</span>
<span class="sd">         win_hop        (float) : step between successive windows in sec.</span>
<span class="sd">                                  Default is 0.01.</span>

<span class="sd">     Returns:</span>
<span class="sd">         array of frames.</span>
<span class="sd">         frame length.</span>
<span class="sd">     """</span>
     <span class="c1"># compute frame length and frame step (convert from seconds to samples)</span>
     <span class="n">frame_length</span> <span class="o">=</span> <span class="n">win_len</span> <span class="o">*</span> <span class="n">fs</span>
     <span class="n">frame_step</span> <span class="o">=</span> <span class="n">win_hop</span> <span class="o">*</span> <span class="n">fs</span>
     <span class="n">signal_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
     <span class="n">frames_overlap</span> <span class="o">=</span> <span class="n">frame_length</span> <span class="o">-</span> <span class="n">frame_step</span>

     <span class="c1"># Make sure that we have at least 1 frame+</span>
     <span class="n">num_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">signal_length</span> <span class="o">-</span> <span class="n">frames_overlap</span><span class="p">)</span> <span class="o">//</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">frame_length</span> <span class="o">-</span> <span class="n">frames_overlap</span><span class="p">)</span>
     <span class="n">rest_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">signal_length</span> <span class="o">-</span> <span class="n">frames_overlap</span><span class="p">)</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">frame_length</span> <span class="o">-</span> <span class="n">frames_overlap</span><span class="p">)</span>

     <span class="c1"># Pad Signal to make sure that all frames have equal number of samples</span>
     <span class="c1"># without truncating any samples from the original signal</span>
     <span class="k">if</span> <span class="n">rest_samples</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
         <span class="n">pad_signal_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">frame_step</span> <span class="o">-</span> <span class="n">rest_samples</span><span class="p">)</span>
         <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">pad_signal_length</span><span class="p">))</span>
         <span class="n">pad_signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
         <span class="n">num_frames</span> <span class="o">+=</span> <span class="mi">1</span>
     <span class="k">else</span><span class="p">:</span>
         <span class="n">pad_signal</span> <span class="o">=</span> <span class="n">sig</span>

     <span class="c1"># make sure to use integers as indices</span>
     <span class="n">frame_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">frame_length</span><span class="p">)</span>
     <span class="n">frame_step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">frame_step</span><span class="p">)</span>
     <span class="n">num_frames</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_frames</span><span class="p">)</span>

     <span class="c1"># compute indices</span>
     <span class="n">idx1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">frame_length</span><span class="p">),</span> <span class="p">(</span><span class="n">num_frames</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
     <span class="n">idx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_frames</span> <span class="o">*</span> <span class="n">frame_step</span><span class="p">,</span> <span class="n">frame_step</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">frame_length</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
     <span class="n">indices</span> <span class="o">=</span> <span class="n">idx1</span> <span class="o">+</span> <span class="n">idx2</span>
     <span class="n">frames</span> <span class="o">=</span> <span class="n">pad_signal</span><span class="p">[</span><span class="n">indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="bp">False</span><span class="p">)]</span>
     <span class="k">return</span> <span class="n">frames</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="line-block">
<div class="line"><br/></div>
</div>
<p>Alternatively, one can use the stride trick and use a sliding window technique that is
already implemented in matlab to get a much faster framing. This is done like the following.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Framing 2</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>


 <span class="k">def</span> <span class="nf">strided_app</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">S</span> <span class="p">):</span>
     <span class="sd">"""</span>
<span class="sd">     apply stride trick to create a view into the array with the given shape and stride.</span>

<span class="sd">     Args:</span>
<span class="sd">         a      (array) : a mono audio signal (Nx1) from which to compute features.</span>
<span class="sd">         L        (int) : window length in samples count.</span>
<span class="sd">         S        (int) : step between successive windows in samples count.</span>

<span class="sd">     Returns:</span>
<span class="sd">         array of arrays.</span>
<span class="sd">     """</span>
     <span class="n">nrows</span> <span class="o">=</span> <span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="n">L</span><span class="p">)</span> <span class="o">//</span> <span class="n">S</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
     <span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
     <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">stride_tricks</span><span class="o">.</span><span class="n">as_strided</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">L</span><span class="p">),</span> <span class="n">strides</span><span class="o">=</span><span class="p">(</span><span class="n">S</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>


 <span class="k">def</span> <span class="nf">framing</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">16000</span><span class="p">,</span> <span class="n">win_len</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">win_hop</span><span class="o">=</span><span class="mf">0.025</span><span class="p">):</span>
     <span class="sd">"""</span>
<span class="sd">     transform a signal into a series of overlapping frames.</span>

<span class="sd">     Args:</span>
<span class="sd">         sig            (array) : a mono audio signal (Nx1) from which to compute features.</span>
<span class="sd">         fs               (int) : the sampling frequency of the signal we are working with.</span>
<span class="sd">                                  Default is 16000.</span>
<span class="sd">         win_len        (float) : window length in sec.</span>
<span class="sd">                                  Default is 0.025.</span>
<span class="sd">         win_hop        (float) : step between successive windows in sec.</span>
<span class="sd">                                  Default is 0.01.</span>

<span class="sd">     Returns:</span>
<span class="sd">         array of frames.</span>
<span class="sd">     """</span>
     <span class="c1"># compute frame length and frame step (convert from seconds to samples)</span>
     <span class="n">frame_length</span> <span class="o">=</span> <span class="n">win_len</span> <span class="o">*</span> <span class="n">fs</span>
     <span class="n">frame_step</span> <span class="o">=</span> <span class="n">win_hop</span> <span class="o">*</span> <span class="n">fs</span>
     <span class="n">signal_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
     <span class="n">frames_overlap</span> <span class="o">=</span> <span class="n">frame_length</span> <span class="o">-</span> <span class="n">frame_step</span>

     <span class="c1"># compute number of frames and left sample in order to pad if needed to make</span>
     <span class="c1"># sure all frames have equal number of samples  without truncating any samples</span>
     <span class="c1"># from the original signal</span>
     <span class="n">rest_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">signal_length</span> <span class="o">-</span> <span class="n">frames_overlap</span><span class="p">)</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">frame_length</span> <span class="o">-</span> <span class="n">frames_overlap</span><span class="p">)</span>
     <span class="n">pad_signal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">frame_step</span> <span class="o">-</span> <span class="n">rest_samples</span><span class="p">)))</span>

     <span class="c1"># make sure to use integers as indices</span>
     <span class="n">frames</span> <span class="o">=</span> <span class="n">strided_app</span><span class="p">(</span><span class="n">pad_signal</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">frame_length</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">frame_step</span><span class="p">))</span>
     <span class="k">return</span> <span class="n">frames</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>This blog presented framing, which is a fundamental signal processing technique to that divides a signal into multiple, equally sized, blocks.
The resulting blocks are considered stationary over time, which helps extract useful characterizing features of the signal.
This operation can be implemented in python in a classical fashion or using the stride trick for a fast processing.</p>
</div>
<div class="section" id="references-and-further-readings">
<h2>References and Further readings<a class="headerlink" href="#references-and-further-readings" title="Permalink to this headline">¶</a></h2>
<p id="bibtex-bibliography-blog/SignalFraming-0"><dl class="citation">
<dt class="label" id="deller"><span class="brackets"><a class="fn-backref" href="#id1">JRJD87</a></span></dt>
<dd><p>J. H. L. HANSEN J. R. JR Deller, J. G. PROAKIS. <em>Discrete-Time Processing of Speech Signals</em>. New Jersey: Prentice-Hall, 1987.</p>
</dd>
</dl>
</p>
</div>
</div>
<div class="section">
<div class="section">
<span style="float: left;">
  
  Previous: 
  <a href="diabetesML2.html">
    
    [30-06-2019] Diabetes detection using machine learning (part II)
  </a>
</span>
<span> </span>
<span style="float: right;">
</span></div>
</div>
</div>
</div>
<div class="clearer"></div>
</body></html>
<div class="footer">
      ©2020, Ayoub Malek.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="../_sources/blog/SignalFraming.rst.txt" rel="nofollow">Page source</a>
</div><script src="../_static/js/mode-switcher.js"></script>

