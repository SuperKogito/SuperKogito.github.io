
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<meta content="aiohttp server" name="description" />
<meta content="server, client, python" name="keywords" />
<meta content="Ayoub Malek" name="author" />
<script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-133660046-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <title>Token authenticated aiohttp Server &#8212; Ayoub Malek&#39;s blog</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom_style.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />
  
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
          

          <div class="body" role="main">
            <!-- START Bootstrap-Cookie-Alert -->
            <div class="alert text-center cookiealert" role="alert">
                <div class="cookiesContainer">
                  <b>
                    We use cookies and other technologies to perform analytics and deliver a better user experience.
                    By clicking “I agree” below, you consent to the use by us and our third-party partners of cookies and data gathered from your use of this website.
                    See our <a href="https://cookiesandyou.com/" target="_blank">Privacy Policy</a> and <a href="https://cookiesandyou.com/" target="_blank">Third Party Partners</a> to learn more about the use of data and your rights.
                    You also agree to our <a href="https://cookiesandyou.com/" target="_blank">Terms of Service</a>.
                </b>
                <button type="button" class="btn btn-primary btn-sm acceptcookies">
                    I agree
                </button>
              </div>
            </div>
            <!-- END Bootstrap-Cookie-Alert -->

             <section id="token-authenticated-aiohttp-server">
<h1>Token authenticated aiohttp Server<a class="headerlink" href="#token-authenticated-aiohttp-server" title="Permalink to this headline">¶</a></h1>
<div class="blog-post-tags">
  <ul class="blog-posts-details">
  <li id="Date"><span>Date:</span>                 31 December 2021 </li>
  <li id="author"><span>Author:</span>            <a href="author/ayoub-malek.html">Ayoub Malek</a> </li>
  <li id="location"><span>Location:</span>        <a href="location/monastir.html">Monastir</a>
  </li>  <li id="language"><span>Language:</span> <a href="language/english.html">English</a>
  </li>  <li id="category"><span>Category:</span> <a href="category/server-client.html">Server-client</a>
  </li>
  <li id="tags"><span>Tags:
        </span>
        <a class="post-tags" href="tag/audio.html">Server-Client</a>
        <a class="post-tags" href="tag/python.html">Python</a>
  </li>
  </ul>
</div><hr class="docutils" />
<p>In the previous blog post, a simple aiohttp server was introduced.
In the following post we improve the previous server by introducing a simple token authentication mechanism.</p>
<section id="why-authenticate">
<h2>Why authenticate ?<a class="headerlink" href="#why-authenticate" title="Permalink to this headline">¶</a></h2>
<p>Authentication is a crucial part when dealing with server-client connection.
If your resources are limited and your server has no filter mechanism of whom to serve, an overload of requests would break your server.
This the one of the simplest yet efficient Denial of Service attacks (DOS).
Hence an authentication mechanism will help filter unrecognized requests and will spare you the computational power and attention.</p>
</section>
<section id="why-use-tokens">
<h2>why use tokens?<a class="headerlink" href="#why-use-tokens" title="Permalink to this headline">¶</a></h2>
<p>Token based authentication is one of the cheapest and the simplest approach.
It is an efficient filtering approach is the data communicated is not that important.
Depending on how you generate your valid tokens and how you communicate them you can improve your security but this will not be discussed here.</p>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>To improve the previous implementation, we will push all the config variables into one JSON file and we will name it <cite>config.json</cite>.
This will include all the configuration parameters for our script. It will look like the following.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">config.json</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="o">{</span>
<span class="linenos"> 2</span>  <span class="s2">&quot;server&quot;</span>: <span class="o">{</span>
<span class="linenos"> 3</span>    <span class="s2">&quot;http&quot;</span>: <span class="o">{</span>
<span class="linenos"> 4</span>      <span class="s2">&quot;host&quot;</span>: <span class="s2">&quot;127.0.0.1&quot;</span>,
<span class="linenos"> 5</span>      <span class="s2">&quot;port&quot;</span>: <span class="m">8000</span>,
<span class="linenos"> 6</span>      <span class="s2">&quot;request_max_size&quot;</span>: <span class="m">1048576</span>,
<span class="linenos"> 7</span>      <span class="s2">&quot;allowed_tokens&quot;</span>: <span class="o">[</span><span class="s2">&quot;token1&quot;</span>,<span class="s2">&quot;token2&quot;</span><span class="o">]</span>
<span class="linenos"> 8</span>    <span class="o">}</span>
<span class="linenos"> 9</span>  <span class="o">}</span>,
<span class="linenos">10</span>  <span class="s2">&quot;log&quot;</span>: <span class="o">{</span>
<span class="linenos">11</span>    <span class="s2">&quot;level&quot;</span>: <span class="o">[{</span>
<span class="linenos">12</span>      <span class="s2">&quot;logger&quot;</span>: <span class="s2">&quot;server_logger&quot;</span>,
<span class="linenos">13</span>      <span class="s2">&quot;level&quot;</span>: <span class="s2">&quot;DEBUG&quot;</span>
<span class="linenos">14</span>    <span class="o">}]</span>
<span class="linenos">15</span>  <span class="o">}</span>
<span class="linenos">16</span><span class="o">}</span>
</pre></div>
</div>
</div>
<p>As you see in the config, we are now able to configure the host and the port to run the server on.
We are also able to constraint the size of the accepted requests along with providing a list of accepted valid tokens.
Furthermore, we added a logger and a debug level to investigate possible errors.</p>
<p>The following section will detail the work.</p>
<ol class="arabic">
<li><p><strong>First we configure the logger.</strong></p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">aiohttp-server-with-token-auth</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">import</span> <span class="nn">logging</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="c1"># init loggging</span>
<span class="linenos">4</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="linenos">5</span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;[</span><span class="si">%(asctime)s</span><span class="s2">.</span><span class="si">%(msecs)03d</span><span class="s2">] p</span><span class="si">%(process)s</span><span class="s2"> {</span><span class="si">%(pathname)s</span><span class="s2">: </span><span class="si">%(funcName)s</span><span class="s2">: </span><span class="si">%(lineno)d</span><span class="s2">}: </span><span class="si">%(levelname)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %p %I:%M:%S&quot;</span><span class="p">)</span>
<span class="linenos">6</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</li>
<li><p><strong>Write a request handler.</strong>
Requests in aiohttp are processed using coroutines that will serve as the actual functions called by the client.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Write a request handler</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos">2</span> <span class="kn">from</span> <span class="nn">aiohttp</span> <span class="kn">import</span> <span class="n">web</span>
<span class="linenos">3</span>
<span class="linenos">4</span> <span class="nd">@asyncio</span><span class="o">.</span><span class="n">coroutine</span>
<span class="linenos">5</span> <span class="k">def</span> <span class="nf">ping</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="linenos">6</span>     <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">json_response</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;pong&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</li>
<li><p><strong>wrap everything by creating an Application instance and registering the request handler</strong></p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Create application and register handler</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="linenos">2</span> <span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">ping</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</li>
</ol>
</section>
<section id="code">
<h2>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<p>The previously listed steps, should look together in Python as follows:</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">aiohttp-server-with-token-auth</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">os</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos"> 3</span><span class="kn">import</span> <span class="nn">json</span>
<span class="linenos"> 4</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos"> 5</span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="linenos"> 6</span><span class="kn">import</span> <span class="nn">logging</span>
<span class="linenos"> 7</span><span class="kn">import</span> <span class="nn">threading</span>
<span class="linenos"> 8</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 9</span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="kn">import</span> <span class="n">web</span>
<span class="linenos">10</span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Coroutine</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="linenos">11</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="c1"># init loggging</span>
<span class="linenos">14</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="linenos">15</span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;[</span><span class="si">%(asctime)s</span><span class="s2">.</span><span class="si">%(msecs)03d</span><span class="s2">] p</span><span class="si">%(process)s</span><span class="s2"> {</span><span class="si">%(pathname)s</span><span class="s2">: </span><span class="si">%(funcName)s</span><span class="s2">: </span><span class="si">%(lineno)d</span><span class="s2">}: </span><span class="si">%(levelname)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %p %I:%M:%S&quot;</span><span class="p">)</span>
<span class="linenos">16</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="c1"># parse conf</span>
<span class="linenos">19</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;config.json&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">config_file</span><span class="p">:</span>
<span class="linenos">20</span>    <span class="n">conf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="nd">@asyncio</span><span class="o">.</span><span class="n">coroutine</span>
<span class="linenos">23</span><span class="k">def</span> <span class="nf">ping</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="linenos">24</span>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;-&gt; Received PING&quot;</span><span class="p">)</span>
<span class="linenos">25</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">json_response</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;pong&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">})</span>
<span class="linenos">26</span>    <span class="k">return</span> <span class="n">response</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="k">def</span> <span class="nf">token_auth_middleware</span><span class="p">(</span><span class="n">user_loader</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
<span class="linenos">29</span>                          <span class="n">request_property</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span>
<span class="linenos">30</span>                          <span class="n">auth_scheme</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Token&#39;</span><span class="p">,</span>
<span class="linenos">31</span>                          <span class="n">exclude_routes</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(),</span>
<span class="linenos">32</span>                          <span class="n">exclude_methods</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">Coroutine</span><span class="p">:</span>
<span class="linenos">33</span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">34</span><span class="sd">    Checks a auth token and adds a user from user_loader in request.</span>
<span class="linenos">35</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">36</span>    <span class="nd">@web</span><span class="o">.</span><span class="n">middleware</span>
<span class="linenos">37</span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">middleware</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
<span class="linenos">38</span>        <span class="k">try</span>               <span class="p">:</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="linenos">39</span>        <span class="k">except</span> <span class="ne">KeyError</span>   <span class="p">:</span> <span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPUnauthorized</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Missing authorization header&#39;</span><span class="p">,)</span>
<span class="linenos">40</span>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPForbidden</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Invalid authorization header&#39;</span><span class="p">,)</span>
<span class="linenos">41</span>
<span class="linenos">42</span>        <span class="k">if</span> <span class="n">auth_scheme</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">scheme</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<span class="linenos">43</span>            <span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPForbidden</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Invalid token scheme&#39;</span><span class="p">,)</span>
<span class="linenos">44</span>
<span class="linenos">45</span>        <span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">user_loader</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<span class="linenos">46</span>        <span class="k">if</span> <span class="n">user</span> <span class="p">:</span> <span class="n">request</span><span class="p">[</span><span class="n">request_property</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
<span class="linenos">47</span>        <span class="k">else</span>    <span class="p">:</span> <span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPForbidden</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Token doesn</span><span class="se">\&#39;</span><span class="s1">t exist&#39;</span><span class="p">)</span>
<span class="linenos">48</span>        <span class="k">return</span> <span class="k">await</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="linenos">49</span>    <span class="k">return</span> <span class="n">middleware</span>
<span class="linenos">50</span>
<span class="linenos">51</span><span class="k">async</span> <span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
<span class="linenos">52</span>    <span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">53</span><span class="sd">    Init web application.</span>
<span class="linenos">54</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">55</span>    <span class="k">async</span> <span class="k">def</span> <span class="nf">user_loader</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="linenos">56</span>        <span class="n">user</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="s1">&#39;fake-uuid&#39;</span><span class="p">}</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;http&quot;</span><span class="p">][</span><span class="s2">&quot;allowed_tokens&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
<span class="linenos">57</span>        <span class="k">return</span> <span class="n">user</span>
<span class="linenos">58</span>
<span class="linenos">59</span>    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="n">client_max_size</span><span class="o">=</span><span class="n">conf</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;http&quot;</span><span class="p">][</span><span class="s2">&quot;request_max_size&quot;</span><span class="p">],</span>
<span class="linenos">60</span>                          <span class="n">middlewares</span><span class="o">=</span><span class="p">[</span><span class="n">token_auth_middleware</span><span class="p">(</span><span class="n">user_loader</span><span class="p">)])</span>
<span class="linenos">61</span>    <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/ping&#39;</span><span class="p">,</span> <span class="n">ping</span><span class="p">)</span>
<span class="linenos">62</span>    <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/stt&#39;</span><span class="p">,</span> <span class="n">stt</span><span class="p">)</span>
<span class="linenos">63</span>    <span class="k">return</span> <span class="n">app</span>
<span class="linenos">64</span>
<span class="linenos">65</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">66</span>    <span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">init</span><span class="p">(),)</span>
</pre></div>
</div>
</div>
<p>The previous code, can require slight changes when creating the application and registering the handler in the case of using multi-processing for example.</p>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>The previous code when executed will start a server running on to <a class="reference external" href="http://localhost:8080/">http://localhost:8080/</a>.
To test your server either type in your browser <a class="reference external" href="http://localhost:8080/ping">http://localhost:8080/ping</a> simply <a class="reference external" href="https://curl.se/">curl</a> it while passing your token using <a href="#id1"><span class="problematic" id="id2">`</span></a>curl -H ‘Authorization: Token token1’ <a class="reference external" href="http://127.0.0.1:8080/ping">http://127.0.0.1:8080/ping</a>
<a href="#id3"><span class="problematic" id="id4">`</span></a>.
The response should be the following json.</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>This blog presented an improved aiohttp server that implements token based authentication to filter out unwanted traffic and protect itself against possible spamming attacks
that could be part of DOS attacks.</p>
</section>
<section id="references-and-further-readings">
<h2>References and Further readings<a class="headerlink" href="#references-and-further-readings" title="Permalink to this headline">¶</a></h2>
</section>
</section>

<div class="section">
    

<div class="section">
  <span style="float: left">
     Previous:
    
    <a href="AiohttpServer.html">
       Basic aiohttp Server
    </a>
    
  </span>
  <span>&nbsp;</span>
  <span style="float: right">
    
  </span>
</div>
  
</div>

          </div>
          
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019-2022, Ayoub Malek.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      | <a href="https://github.com/bitprophet/alabaster">Terms of Service</a>
      | <a href="https://github.com/bitprophet/alabaster">Privacy Policy</a>
      | <a href="https://github.com/bitprophet/alabaster">Impressum</a>

      
    </div>

    

    
    <!-- Include cookiealert script -->
    <script src="https://cdn.jsdelivr.net/gh/Wruczek/Bootstrap-Cookie-Alert@gh-pages/cookiealert.js"></script>
    <script src="_static/js/share-buttons.js"></script>
  </body>
</html>