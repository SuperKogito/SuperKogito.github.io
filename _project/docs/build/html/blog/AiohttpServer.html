<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8"/><meta content="aiohttp server" name="description"/>
<meta content="server, client, python" name="keywords"/>
<meta content="Ayoub Malek" name="author"/>
<script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-133660046-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
<title>Basic aiohttp Server — Ayoub Malek's blog</title>
<link href="../_static/alabaster.css" rel="stylesheet" type="text/css"/>
<link href="../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
<link href="../_static/css/custom_style.css" rel="stylesheet" type="text/css"/>
<script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js" type="text/javascript"></script>
<script src="../_static/jquery.js" type="text/javascript"></script>
<script src="../_static/underscore.js" type="text/javascript"></script>
<script src="../_static/doctools.js" type="text/javascript"></script>
<script src="../_static/language_data.js" type="text/javascript"></script>
<script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<link href="../_static/favicon.ico" rel="shortcut icon"/>
<link href="../about.html" rel="author" title="About these documents"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="../_static/custom.css" rel="stylesheet" type="text/css"/>
<meta content="width=device-width, initial-scale=0.9, maximum-scale=0.9" name="viewport"/>
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/></head><body>
<div class="document">
<div class="documentwrapper">
<div class="body" role="main">
<!-- START Bootstrap-Cookie-Alert -->
<div class="alert text-center cookiealert" role="alert">
<div class="cookiesContainer">
<b>
                    We use cookies and other technologies to perform analytics and deliver a better user experience.
                    By clicking “I agree” below, you consent to the use by us and our third-party partners of cookies and data gathered from your use of this website.
                    See our <a href="https://cookiesandyou.com/" target="_blank">Privacy Policy</a> and <a href="https://cookiesandyou.com/" target="_blank">Third Party Partners</a> to learn more about the use of data and your rights.
                    You also agree to our <a href="https://cookiesandyou.com/" target="_blank">Terms of Service</a>.
                </b>
<button class="btn btn-primary btn-sm acceptcookies" type="button">
                    I agree
                </button>
</div>
</div>
<!-- END Bootstrap-Cookie-Alert -->
<div class="section" id="basic-aiohttp-server">
<h1>Basic aiohttp Server<a class="headerlink" href="#basic-aiohttp-server" title="Permalink to this headline">¶</a></h1><html><body><div class="sub-title-menu">
<table class="menu-table" id="menuTable" style="border:hidden;">
<tr>
<th>
</th><th>
</th><th class="icon"> <a href="../index.html" title="Home"><i class="fa fa-home"></i></a> </th>
<th class="menu-label"> <a href="../index.html" title="Home">Home</a> </th>
<th>
</th><th>
</th><th class="icon"><a href="../posts.html" title="Posts"><i class="fa fa-bars"></i></a></th>
<th class="menu-label"><a href="../posts.html" title="Posts">Posts</a></th>
<th>
</th><th>
</th><th class="icon"> <a href="../publications.html" title="pubs"><i class="fa fa-file-text"></i></a></th>
<th class="menu-label"> <a href="../publications.html" title="pubs">Publications</a></th>
<th>
</th><th>
</th><th class="icon"> <a href="../projects.html" title="projects"><i class="fa fa-code"></i></a></th>
<th class="menu-label"> <a href="../projects.html" title="projects">Projects</a></th>
<th>
</th><th>
</th><th class="icon"><a href="../about.html" title="About"><i class="fa fa-user-circle"></i></a></th>
<th class="menu-label"><a href="../about.html" title="About">About</a></th>
<th>
</th><th>
</th><th class="icon"> <a href="#" onclick="modeSwitcher()"><i class="fa fa-adjust"></i></a></th>
<th class="menu-label"> <a href="#" onclick="modeSwitcher()"><text id="theme-toggle">DARK MODE</text></a></th>
</tr>
</table>
</div>
</body></html>
<div class="blog-post-tags">
<ul class="blog-posts-details">
<li id="Date"><span>Date:</span>                 31 December 2021 </li>
<li id="author"><span>Author:</span> <a href="author/ayoub-malek.html">Ayoub Malek</a> </li>
<li id="location"><span>Location:</span> <a href="location/monastir.html">Monastir</a>
</li> <li id="language"><span>Language:</span> <a href="language/english.html">English</a>
</li> <li id="category"><span>Category:</span> <a href="category/server-client.html">Server-client</a>
</li>
<li id="tags"><span>Tags:
        </span>
<a class="post-tags" href="tag/audio.html">Server-Client</a>
<a class="post-tags" href="tag/python.html">Python</a>
</li>
</ul>
</div><hr class="docutils"/>
<p>When it comes to deploying an application on a server online, a crucial aspect is its response time since no user wants to wait long for a response.
Hence, optimizations and asynchronous processing are the way to go. within this context, aiohttp is a python library that helps implementing asynchronous HTTP Client/Server.
The following blog one of a series of 4 that will introduce a server implementation, followed by a token based authentication and some stress testing.</p>
<div class="section" id="what-is-aiohttp">
<h2>What is aiohttp ?<a class="headerlink" href="#what-is-aiohttp" title="Permalink to this headline">¶</a></h2>
<p>aiohttp is an HTTP client/server for asyncio.
Basically it allows you to write asynchronous clients and servers.
The aiohttp package also supports Server WebSockets and Client WebSockets.</p>
</div>
<div class="section" id="what-is-asyncio">
<h2>what is asyncio?<a class="headerlink" href="#what-is-asyncio" title="Permalink to this headline">¶</a></h2>
<p>asyncio is a library to write concurrent code.
It is used at the core of many asynchronous applications to deliver high-performance and speedy processing, etc.</p>
</div>
<div class="section" id="what-is-concurrency">
<h2>what is concurrency?<a class="headerlink" href="#what-is-concurrency" title="Permalink to this headline">¶</a></h2>
<p>In simple words, concurrency can be described as having multiple computations happening at the same time.
In a little more complex formulation, it can be described as the execution of different parts a program out-of-order or in partial order.
Hence, you can say concurrency is sort of partial parallelism of computations.</p>
</div>
<div class="section" id="why-is-concurrency-useful-in-server-client-communications">
<h2>Why is concurrency useful in server/client communications?<a class="headerlink" href="#why-is-concurrency-useful-in-server-client-communications" title="Permalink to this headline">¶</a></h2>
<p>The ability to have multiple units of your code running in parallel allows you to handle more requests or even send multiple calls without requiring more physical resources.
In other words, by asynchronously running your functions you can push your system to its limits but you should mind your processing order to avoid unexpected behaviors.</p>
</div>
<div class="section" id="how-to-implement-it">
<h2>How to implement it?<a class="headerlink" href="#how-to-implement-it" title="Permalink to this headline">¶</a></h2>
<p>Aiohttp includes a variey of examples on how to do this. In the following steps, I will only include here, what worked best for me:</p>
<ol class="arabic">
<li><p><strong>Start with installing aiohttp using</strong></p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Install aiohttp</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span> pip install aiohttp
</pre></div>
</td></tr></table></div>
</div>
</li>
<li><p><strong>Write a request handler.</strong>
Requests in aiohttp are processed using coroutines that will serve as the actual functions called by the client.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Write a request handler</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
 <span class="kn">from</span> <span class="nn">aiohttp</span> <span class="kn">import</span> <span class="n">web</span>

 <span class="nd">@asyncio</span><span class="o">.</span><span class="n">coroutine</span>
 <span class="k">def</span> <span class="nf">ping</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">json_response</span><span class="p">({</span><span class="s2">"text"</span><span class="p">:</span> <span class="s2">"pong"</span><span class="p">,</span> <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"success"</span><span class="p">})</span>
</pre></div>
</td></tr></table></div>
</div>
</li>
<li><p><strong>wrap everything by creating an Application instance and registering the request handler</strong></p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Create application and register handler</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
 <span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="n">ping</span><span class="p">)])</span>
</pre></div>
</td></tr></table></div>
</div>
</li>
</ol>
</div>
<div class="section" id="code">
<h2>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<p>The previously listed steps, should look together in Python as follows:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Framing 1</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiohttp</span> <span class="kn">import</span> <span class="n">web</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">ping</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">"pong"</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_routes</span><span class="p">([</span><span class="n">web</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="n">ping</span><span class="p">)])</span>
</pre></div>
</td></tr></table></div>
</div>
<p>The previous code, can require slight changes when creating the application and registering the handler in the case of using multi-processing for example.</p>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>The previous code when executed will start a server running on to <a class="reference external" href="http://localhost:8080/">http://localhost:8080/</a>.
To test your server either type in your browser <a class="reference external" href="http://localhost:8080/ping">http://localhost:8080/ping</a> simply <a class="reference external" href="https://curl.se/">curl</a> it using <cite>curl http://localhost:8080/ping</cite>.
The response should be the following json.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>This blog presented aiohttp and its usefulness within regard to concurrency. It further provided a simple example of a server that will respond with pong if it is alive.</p>
</div>
<div class="section" id="references-and-further-readings">
<h2>References and Further readings<a class="headerlink" href="#references-and-further-readings" title="Permalink to this headline">¶</a></h2>
</div>
</div>
<div class="section">
<div class="section">
<span style="float: left">
     Previous:
    
    <a href="chmodmodes.html">
       Chmod modes: from symbolic to octal and back
    </a>
</span>
<span> </span>
<span style="float: right">
     Next: 
    <a href="AiohttpServerWithToken.html">
      Token authenticated aiohttp Server 
    </a>
</span>
</div>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
<div class="footer">
      ©2019-2021, Ayoub Malek.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      | <a href="https://github.com/bitprophet/alabaster">Terms of Service</a>
      | <a href="https://github.com/bitprophet/alabaster">Privacy Policy</a>
      | <a href="https://github.com/bitprophet/alabaster">Impressum</a>
</div><html><head><script async="" defer="" src="https://buttons.github.io/buttons.js"></script></head></html><html><head><script src="../_static/js/mode-switcher.js"></script></head></html>
<!-- Include cookiealert script -->
<script src="https://cdn.jsdelivr.net/gh/Wruczek/Bootstrap-Cookie-Alert@gh-pages/cookiealert.js"></script>
<script src="_static/js/share-buttons.js"></script>
</body>
</html>