
<!DOCTYPE html>


<html lang="english" data-content_root="../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Token authenticated aiohttp server" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://superkogito.github.io/blog/2021/12/31/aiohttp_server_with_token.html" />
<meta property="og:site_name" content="üß† SuperKogito" />
<meta property="og:description" content="authenticated aiohttp servver" />
<meta property="og:image" content="https://superkogito.github.io/_static/meta_images/aiohttp_server_with_token.png" />
<meta property="og:image:alt" content="authenticated_aiohttp_server" />
<meta property="og:keywords" content="authentication, server, client, python, ayoub malek, blog post" />
<meta name="description" content="In the previous blog post, a simple aiohttp server was introduced. In the following post we improve the previous server by introducing a simple token authentication mechanism. Why authenticate?: Authentication is a crucial part when dealing with server-client connections. If your resources are li..." />
<meta property="og:ignore_canonical" content="true" />

    <title>Token authenticated aiohttp server &#8212; üß† SuperKogito  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/custom.css?v=8dbd9e1c" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../../_static/documentation_options.js?v=df973ab0"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'blog/2021/12/31/aiohttp_server_with_token';</script>
    <script src="../../../../_static/js/custom-emoji.js?v=cc023531"></script>
    <link rel="canonical" href="https://superkogito.github.io/blog/2021/12/31/aiohttp_server_with_token.html" />
    <link rel="icon" href="../../../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../../../about.html" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="english">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <!-- Favicons -->
  

  <!-- Google Tag Manager -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GPWJJB9TRK"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-GPWJJB9TRK');
  </script>

  <!-- Google Ads -->
  <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8554106698532684" crossorigin="anonymous"></script> -->


<link
  rel="alternate"
  type="application/atom+xml"
  href="../../../../blog/atom.xml"
  title="SuperKogito"
/>



  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this site..."
         aria-label="Search this site..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">üß† SuperKogito  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../projects.html">
    Projects
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../blog.html">
    Blog
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../about.html">
    About Me
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/superkogito/" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../projects.html">
    Projects
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../blog.html">
    Blog
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../../about.html">
    About Me
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/superkogito/" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<div class="ablog-sidebar-item ablog__postcard">


<h2>
  
  
  <i class="fa fa-calendar"></i>
  
  <span>31 Dezember 2021</span>
  
</h2>
<ul>
  <div class="ablog-sidebar-item ablog__postcard2">

<li id="published">
  <span>
    
    <i class="fa fa-fw fa-edit"></i>
    
    </span>
  08 April 2022
</li>


<li id="ablog-sidebar-item author ablog__author">
  <span>
    
    <i class="fa-fw fa fa-user"></i>
    
    </span>
  
  
  <a href="../../../author/ayoub-malek.html">Ayoub Malek</a>
  
  
  
</li>


<li id="ablog-sidebar-item location ablog__location">
  <span>
    
    <i class="fa-fw fa fa-location-arrow"></i>
    
    </span>
  
  
  <a href="../../../location/monastir.html">Monastir</a>
  
  
  
</li>


<li id="ablog-sidebar-item language ablog__language">
  <span>
    
    <i class="fa-fw fa fa-language"></i>
    
    </span>
  
  
  <a href="../../../language/english.html">English</a>
  
  
  
</li>


<li id="ablog-sidebar-item category ablog__category">
  <span>
    
    <i class="fa-fw fa fa-folder-open"></i>
    
    </span>
  
  
  <a href="../../../category/server-client.html">Server-client</a>
  
  
  
</li>


<li id="ablog-sidebar-item tags ablog__tags">
  <span>
    
    
    <i class="fa-fw fa fa-tags"></i>
    
    
    </span>
  
  
  <a href="../../../tag/python.html">Python</a>
  
  
  
  
  
  <a href="../../../tag/server-client.html">Server-client</a>
  
  
  
</li>


</div>
</ul>
</div>
</div>
        <div class="sidebar-primary-item">
<h3>
  <a href="../../../../blog.html">‚úçÔ∏è Recent Posts</a>
</h3>
<ul>
   
  <li>
    <a href="../../../2022/12/27/whisper_aiohttp_server_with_token.html"
      >Whisper based speech recognition server</a>
      <p>27 Dezember 2022</p>
  </li>
  
  <li>
    <a href="aiohttp_server.html"
      >Basic aiohttp server</a>
      <p>31 Dezember 2021</p>
  </li>
  
  <li>
    <a href="../../../2020/10/25/chmod_modes.html"
      >Chmod modes: from symbolic to octal and back</a>
      <p>25 Oktober 2020</p>
  </li>
  
  <li>
    <a href="../../../2020/10/03/divide_image_using_gdiplus.html"
      >Divide an image into blocks using GDI+ in C++</a>
      <p>03 Oktober 2020</p>
  </li>
  
  <li>
    <a href="../../../2020/10/01/divide_image_using_opencv.html"
      >Divide an image into blocks using OpenCV in C++</a>
      <p>01 Oktober 2020</p>
  </li>
  
</ul>
</div>
        <div class="sidebar-primary-item">
<h3>
  <a href="../../../archive.html">üóìÔ∏è Archives</a>
</h3>
<ul>
   
  <li>
    <a href="../../../2022.html">2022 (1)</a>
  </li>
    
  <li>
    <a href="../../../2021.html">2021 (2)</a>
  </li>
    
  <li>
    <a href="../../../2020.html">2020 (13)</a>
  </li>
    
  <li>
    <a href="../../../2019.html">2019 (7)</a>
  </li>
   
</ul>
</div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Token authenticated aiohttp server</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              


  
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
<section id="token-authenticated-aiohttp-server">
<h1>Token authenticated aiohttp server<a class="headerlink" href="#token-authenticated-aiohttp-server" title="Link to this heading">#</a></h1>
<hr class="docutils" />
<p>In the previous blog post, a simple aiohttp server was introduced.
In the following post we improve the previous server by introducing a simple token authentication mechanism.</p>
<section id="why-authenticate">
<h2>Why authenticate?<a class="headerlink" href="#why-authenticate" title="Link to this heading">#</a></h2>
<p>Authentication is a crucial part when dealing with server-client connections.
If your resources are limited and your server has no filtering mechanism of whom to serve, an overload of requests would break your server.
This the one of the simplest yet efficient Denial of Service attacks (DOS).
Hence an authentication mechanism will help filter unrecognized requests and will spare you the computational power and attention.</p>
</section>
<section id="why-use-tokens">
<h2>Why use tokens?<a class="headerlink" href="#why-use-tokens" title="Link to this heading">#</a></h2>
<p>Token based authentication is one of the cheapest and the simplest approaches.
It is an efficient filtering approach if the data communicated is not that important.
Depending on how you generate your valid tokens, how you communicate/ store them you can improve your security but this will not be discussed here.</p>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Link to this heading">#</a></h2>
<p>To improve the previous implementation, we will push all the config variables into one JSON file and we will name it <cite>config.json</cite>.
This will include all the configuration parameters for our script. It will look like the following.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">config.json</span><a class="headerlink" href="#id1" title="Link to this code">#</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="o">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="s2">&quot;server&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="s2">&quot;http&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="linenos"> 4</span><span class="w">      </span><span class="s2">&quot;host&quot;</span>:<span class="w"> </span><span class="s2">&quot;127.0.0.1&quot;</span>,
<span class="linenos"> 5</span><span class="w">      </span><span class="s2">&quot;port&quot;</span>:<span class="w"> </span><span class="m">8000</span>,
<span class="linenos"> 6</span><span class="w">      </span><span class="s2">&quot;request_max_size&quot;</span>:<span class="w"> </span><span class="m">1048576</span>,
<span class="linenos"> 7</span><span class="w">      </span><span class="s2">&quot;allowed_tokens&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;token1&quot;</span>,<span class="s2">&quot;token2&quot;</span><span class="o">]</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="o">}</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="o">}</span>,
<span class="linenos">10</span><span class="w">  </span><span class="s2">&quot;log&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="linenos">11</span><span class="w">    </span><span class="s2">&quot;level&quot;</span>:<span class="w"> </span><span class="o">[{</span>
<span class="linenos">12</span><span class="w">      </span><span class="s2">&quot;logger&quot;</span>:<span class="w"> </span><span class="s2">&quot;server_logger&quot;</span>,
<span class="linenos">13</span><span class="w">      </span><span class="s2">&quot;level&quot;</span>:<span class="w"> </span><span class="s2">&quot;DEBUG&quot;</span>
<span class="linenos">14</span><span class="w">    </span><span class="o">}]</span>
<span class="linenos">15</span><span class="w">  </span><span class="o">}</span>
<span class="linenos">16</span><span class="o">}</span>
</pre></div>
</div>
</div>
<p>As you see in the config, we are now able to configure the host and the port to run the server on.
We are also able to constraint the size of the accepted requests along with providing a list of accepted valid tokens.
Furthermore, we added a logger and a debug level to investigate possible errors.
The following section will detail the work.</p>
<ol class="arabic">
<li><p><strong>First we configure the logger.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="c1"># init loggging</span>
<span class="linenos">4</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="linenos">5</span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;[</span><span class="si">%(asctime)s</span><span class="s2">.</span><span class="si">%(msecs)03d</span><span class="s2">] p</span><span class="si">%(process)s</span><span class="s2"> {</span><span class="si">%(pathname)s</span><span class="s2">: </span><span class="si">%(funcName)s</span><span class="s2">: </span><span class="si">%(lineno)d</span><span class="s2">}: </span><span class="si">%(levelname)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %p %I:%M:%S&quot;</span><span class="p">)</span>
<span class="linenos">6</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Load the configuration infos.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="c1"># parse conf</span>
<span class="linenos">4</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;config.json&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">config_file</span><span class="p">:</span>
<span class="linenos">5</span>    <span class="n">conf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</li>
<li><p><strong>Write a request handler.</strong>
Requests in aiohttp are processed using coroutines that will serve as the actual functions called by the client.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="linenos">2</span><span class="kn">from</span><span class="w"> </span><span class="nn">aiohttp</span><span class="w"> </span><span class="kn">import</span> <span class="n">web</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="nd">@asyncio</span><span class="o">.</span><span class="n">coroutine</span>
<span class="linenos">5</span><span class="k">def</span><span class="w"> </span><span class="nf">ping</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="linenos">6</span>    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">json_response</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;pong&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">})</span>
</pre></div>
</div>
</li>
<li><p><strong>Write the authentication and token handler</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="linenos"> 2</span><span class="kn">from</span><span class="w"> </span><span class="nn">aiohttp</span><span class="w"> </span><span class="kn">import</span> <span class="n">web</span>
<span class="linenos"> 3</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Coroutine</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">def</span><span class="w"> </span><span class="nf">token_auth_middleware</span><span class="p">(</span><span class="n">user_loader</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
<span class="linenos"> 6</span>                          <span class="n">request_property</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span>
<span class="linenos"> 7</span>                          <span class="n">auth_scheme</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Token&#39;</span><span class="p">,</span>
<span class="linenos"> 8</span>                          <span class="n">exclude_routes</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(),</span>
<span class="linenos"> 9</span>                          <span class="n">exclude_methods</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">Coroutine</span><span class="p">:</span>
<span class="linenos">10</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">11</span><span class="sd">    Checks a auth token and adds a user from user_loader in request.</span>
<span class="linenos">12</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">13</span>    <span class="nd">@web</span><span class="o">.</span><span class="n">middleware</span>
<span class="linenos">14</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">middleware</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
<span class="linenos">15</span>        <span class="k">try</span>               <span class="p">:</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="linenos">16</span>        <span class="k">except</span> <span class="ne">KeyError</span>   <span class="p">:</span> <span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPUnauthorized</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Missing authorization header&#39;</span><span class="p">,)</span>
<span class="linenos">17</span>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPForbidden</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Invalid authorization header&#39;</span><span class="p">,)</span>
<span class="linenos">18</span>
<span class="linenos">19</span>        <span class="k">if</span> <span class="n">auth_scheme</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">scheme</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<span class="linenos">20</span>            <span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPForbidden</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Invalid token scheme&#39;</span><span class="p">,)</span>
<span class="linenos">21</span>
<span class="linenos">22</span>        <span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">user_loader</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<span class="linenos">23</span>        <span class="k">if</span> <span class="n">user</span> <span class="p">:</span> <span class="n">request</span><span class="p">[</span><span class="n">request_property</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
<span class="linenos">24</span>        <span class="k">else</span>    <span class="p">:</span> <span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPForbidden</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Token doesn</span><span class="se">\&#39;</span><span class="s1">t exist&#39;</span><span class="p">)</span>
<span class="linenos">25</span>        <span class="k">return</span> <span class="k">await</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="linenos">26</span>    <span class="k">return</span> <span class="n">middleware</span>
</pre></div>
</div>
</li>
<li><p><strong>Write the server init function and wrap it all.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="linenos"> 2</span><span class="kn">from</span><span class="w"> </span><span class="nn">aiohttp</span><span class="w"> </span><span class="kn">import</span> <span class="n">web</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">init</span><span class="p">():</span>
<span class="linenos"> 5</span><span class="w">   </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 6</span><span class="sd">   Init web application.</span>
<span class="linenos"> 7</span><span class="sd">   &quot;&quot;&quot;</span>
<span class="linenos"> 8</span>   <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">user_loader</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="linenos"> 9</span>       <span class="n">user</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="s1">&#39;fake-uuid&#39;</span><span class="p">}</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;http&quot;</span><span class="p">][</span><span class="s2">&quot;allowed_tokens&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
<span class="linenos">10</span>       <span class="k">return</span> <span class="n">user</span>
<span class="linenos">11</span>
<span class="linenos">12</span>   <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="n">client_max_size</span><span class="o">=</span><span class="n">conf</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;http&quot;</span><span class="p">][</span><span class="s2">&quot;request_max_size&quot;</span><span class="p">],</span>
<span class="linenos">13</span>                         <span class="n">middlewares</span><span class="o">=</span><span class="p">[</span><span class="n">token_auth_middleware</span><span class="p">(</span><span class="n">user_loader</span><span class="p">)])</span>
<span class="linenos">14</span>   <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/ping&#39;</span><span class="p">,</span> <span class="n">ping</span><span class="p">)</span>
<span class="linenos">15</span>   <span class="k">return</span> <span class="n">app</span>
<span class="linenos">16</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">init</span><span class="p">(),)</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="code">
<h2>Code<a class="headerlink" href="#code" title="Link to this heading">#</a></h2>
<p>The previously listed steps, should look together in Python as follows:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">aiohttp-server-with-token-auth</span><a class="headerlink" href="#id2" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="linenos"> 2</span><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="linenos"> 3</span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="linenos"> 4</span><span class="kn">from</span><span class="w"> </span><span class="nn">aiohttp</span><span class="w"> </span><span class="kn">import</span> <span class="n">web</span>
<span class="linenos"> 5</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Coroutine</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c1"># init loggging</span>
<span class="linenos"> 9</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="linenos">10</span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;[</span><span class="si">%(asctime)s</span><span class="s2">.</span><span class="si">%(msecs)03d</span><span class="s2">] p</span><span class="si">%(process)s</span><span class="s2"> {</span><span class="si">%(pathname)s</span><span class="s2">: </span><span class="si">%(funcName)s</span><span class="s2">: </span><span class="si">%(lineno)d</span><span class="s2">}: </span><span class="si">%(levelname)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %p %I:%M:%S&quot;</span><span class="p">)</span>
<span class="linenos">11</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="c1"># parse conf</span>
<span class="linenos">14</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;config.json&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">config_file</span><span class="p">:</span>
<span class="linenos">15</span>    <span class="n">conf</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">config_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="nd">@asyncio</span><span class="o">.</span><span class="n">coroutine</span>
<span class="linenos">18</span><span class="k">def</span><span class="w"> </span><span class="nf">ping</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<span class="linenos">19</span>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;-&gt; Received PING&quot;</span><span class="p">)</span>
<span class="linenos">20</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">json_response</span><span class="p">({</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;pong&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span><span class="p">})</span>
<span class="linenos">21</span>    <span class="k">return</span> <span class="n">response</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="k">def</span><span class="w"> </span><span class="nf">token_auth_middleware</span><span class="p">(</span><span class="n">user_loader</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
<span class="linenos">24</span>                          <span class="n">request_property</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span>
<span class="linenos">25</span>                          <span class="n">auth_scheme</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Token&#39;</span><span class="p">,</span>
<span class="linenos">26</span>                          <span class="n">exclude_routes</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(),</span>
<span class="linenos">27</span>                          <span class="n">exclude_methods</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">Coroutine</span><span class="p">:</span>
<span class="linenos">28</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">29</span><span class="sd">    Checks a auth token and adds a user from user_loader in request.</span>
<span class="linenos">30</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">31</span>    <span class="nd">@web</span><span class="o">.</span><span class="n">middleware</span>
<span class="linenos">32</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">middleware</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
<span class="linenos">33</span>        <span class="k">try</span>               <span class="p">:</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="linenos">34</span>        <span class="k">except</span> <span class="ne">KeyError</span>   <span class="p">:</span> <span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPUnauthorized</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Missing authorization header&#39;</span><span class="p">,)</span>
<span class="linenos">35</span>        <span class="k">except</span> <span class="ne">ValueError</span> <span class="p">:</span> <span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPForbidden</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Invalid authorization header&#39;</span><span class="p">,)</span>
<span class="linenos">36</span>
<span class="linenos">37</span>        <span class="k">if</span> <span class="n">auth_scheme</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">scheme</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
<span class="linenos">38</span>            <span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPForbidden</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Invalid token scheme&#39;</span><span class="p">,)</span>
<span class="linenos">39</span>
<span class="linenos">40</span>        <span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">user_loader</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<span class="linenos">41</span>        <span class="k">if</span> <span class="n">user</span> <span class="p">:</span> <span class="n">request</span><span class="p">[</span><span class="n">request_property</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
<span class="linenos">42</span>        <span class="k">else</span>    <span class="p">:</span> <span class="k">raise</span> <span class="n">web</span><span class="o">.</span><span class="n">HTTPForbidden</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Token doesn</span><span class="se">\&#39;</span><span class="s1">t exist&#39;</span><span class="p">)</span>
<span class="linenos">43</span>        <span class="k">return</span> <span class="k">await</span> <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="linenos">44</span>    <span class="k">return</span> <span class="n">middleware</span>
<span class="linenos">45</span>
<span class="linenos">46</span><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">init</span><span class="p">():</span>
<span class="linenos">47</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">48</span><span class="sd">    Init web application.</span>
<span class="linenos">49</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">50</span>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">user_loader</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="linenos">51</span>        <span class="n">user</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="s1">&#39;fake-uuid&#39;</span><span class="p">}</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;http&quot;</span><span class="p">][</span><span class="s2">&quot;allowed_tokens&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
<span class="linenos">52</span>        <span class="k">return</span> <span class="n">user</span>
<span class="linenos">53</span>
<span class="linenos">54</span>    <span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="n">client_max_size</span><span class="o">=</span><span class="n">conf</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;http&quot;</span><span class="p">][</span><span class="s2">&quot;request_max_size&quot;</span><span class="p">],</span>
<span class="linenos">55</span>                          <span class="n">middlewares</span><span class="o">=</span><span class="p">[</span><span class="n">token_auth_middleware</span><span class="p">(</span><span class="n">user_loader</span><span class="p">)])</span>
<span class="linenos">56</span>    <span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/ping&#39;</span><span class="p">,</span> <span class="n">ping</span><span class="p">)</span>
<span class="linenos">57</span>    <span class="k">return</span> <span class="n">app</span>
<span class="linenos">58</span>
<span class="linenos">59</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">60</span>    <span class="n">web</span><span class="o">.</span><span class="n">run_app</span><span class="p">(</span><span class="n">init</span><span class="p">(),)</span>
</pre></div>
</div>
</div>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading">#</a></h2>
<p>The previous code when executed will start a server running on <code class="code docutils literal notranslate"><span class="pre">http://localhost:8080/</span></code>.
To test your server either type in your browser <code class="code docutils literal notranslate"><span class="pre">http://localhost:8080/ping</span></code> or simply <a class="reference external" href="https://curl.se/">curl</a> it while passing your token using <code class="code docutils literal notranslate"><span class="pre">curl</span> <span class="pre">-H</span> <span class="pre">'Authorization:</span> <span class="pre">Token</span> <span class="pre">token1'</span> <span class="pre">http://127.0.0.1:8080/ping</span></code>.
The response should be a json including pong and a success status.</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
<p>This blog presented an improved aiohttp server that implements token based authentication to filter out unwanted traffic and protect itself against possible spamming attacks
that could be part of DOS attacks.</p>
</section>
<section id="share-this-blog">
<h2>Share this blog<a class="headerlink" href="#share-this-blog" title="Link to this heading">#</a></h2>
<div id="share">
  <a class="facebook" href="https://www.facebook.com/share.php?u=https://superkogito.github.io/blog/2021/12/31/aiohttp_server_with_token.html&title=Token%20authenticated%20aiohttp%20Server"                target="blank"><i class="fa-brands fa-facebook"></i></a>
  <a class="twitter"  href="https://twitter.com/intent/tweet?url=https://superkogito.github.io/blog/2021/12/31/aiohttp_server_with_token.html&text=Token%20authenticated%20aiohttp%20Server"                 target="blank"><i class="fa-brands fa-twitter"></i></a>
  <a class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://superkogito.github.io/blog/2021/12/31/aiohttp_server_with_token.html&title=Token%20authenticated%20aiohttp%20Server" target="blank"><i class="fa-brands fa-linkedin"></i></a>
  <a class="reddit"   href="http://www.reddit.com/submit?url=https://superkogito.github.io/blog/2021/12/31/aiohttp_server_with_token.html&title=Token%20authenticated%20aiohttp%20Server"                    target="blank"><i class="fa-brands fa-reddit"></i></a>
</div><div class="note update admonition">
<p class="admonition-title">Updated on 08 April 2022</p>
<p>üë®‚Äçüíª edited and review were on 08.04.2022</p>
</div>
</section>
</section>

<div class="section ablog__blog_comments">
  
  


<div class="section ablog__prev-next">
  <span class="ablog__prev">
    
    
    <a href="aiohttp_server.html">
      
      <i class="fa fa-arrow-circle-left"></i>
      
      <span>Basic aiohttp server</span>
    </a>
    
  </span>
  <span class="ablog__spacer">&nbsp;</span>
  <span class="ablog__next">
    
    
    <a href="../../../2022/12/27/whisper_aiohttp_server_with_token.html">
      <span>Whisper based speech recognition server</span>
      
      <i class="fa fa-arrow-circle-right" ></i>
      
    </a>
    
  </span>
</div>

  
  
</div>

                </article>
              
  
  <!-- Comments Section -->
  <script 
    src="https://giscus.app/client.js"
    data-repo="superKogito/SuperKogito.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkxNTk5NjI3Mjg="
    data-category="Announcements"
    data-category-id="DIC_kwDOCYjWaM4CObax"
    data-mapping="pathname"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="light"
    data-lang="en"
    crossorigin="anonymous"
    async
  ></script>
  
  <!-- Cookie Alert Script -->
  <script src="../../../../_static/js/cookiealert.js"></script>

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-authenticate">Why authenticate?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-use-tokens">Why use tokens?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code">Code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing">Testing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#share-this-blog">Share this blog</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../_sources/blog/2021/12/31/aiohttp_server_with_token.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      ¬© Copyright 2019-2025, Ayoub Malek.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>